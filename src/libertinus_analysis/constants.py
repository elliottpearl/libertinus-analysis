# data/constants.py
# Constants 

from pathlib import Path

ROOT = Path(__file__).resolve().parent.parent  # project root

# Font path

FONTS = ROOT / "fonts"

fonts = {
    "regular": {
        "path": FONTS / "LibertinusSerif-Regular.otf",
        "lookup_index": 4,
        "style": "regular",
        "label": "Regular",
    },
    "regular_patch": {
        "path": FONTS / "LibertinusSerif-Regular-patch.otf",
        "lookup_index": 4,
        "style": "regular",
        "label": "Regular patched",
    },
    "italic": {
        "path": FONTS / "LibertinusSerif-Italic.otf",
        "lookup_index": 4,
        "style": "italic",
        "label": "Italic",
    },
    "semibold": {
        "path": FONTS / "LibertinusSerif-Semibold.otf",
        "lookup_index": 1,
        "style": "bold",
        "label": "Semibold",
    },
    "semibold_italic": {
        "path": FONTS / "LibertinusSerif-SemiboldItalic.otf",
        "lookup_index": 2,
        "style": "bold_italic",
        "label": "Semibold italic",
    },
}

# Bases

# Latin (count: ?)
latin = [
    # Basic Latin A–Z, a–z
    0x0041,0x0042,0x0043,0x0044,0x0045,0x0046,0x0047,0x0048,0x0049,0x004A,
    0x004B,0x004C,0x004D,0x004E,0x004F,0x0050,0x0051,0x0052,0x0053,0x0054,
    0x0055,0x0056,0x0057,0x0058,0x0059,0x005A,
    0x0061,0x0062,0x0063,0x0064,0x0065,0x0066,0x0067,0x0068,0x0069,0x006A,
    0x006B,0x006C,0x006D,0x006E,0x006F,0x0070,0x0071,0x0072,0x0073,0x0074,
    0x0075,0x0076,0x0077,0x0078,0x0079,0x007A,
    # Ligatures and special bases
    0x00C6,0x00E6,      # Æ æ
    0x0152,0x0153,      # Œ œ
    0x00D8,0x00F8,      # Ø ø
    0x00D0,0x00F0,      # Ð ð
    0x00DE,0x00FE,      # Þ þ
    0x00DF,             # ß
    0x017F,             # ſ
    # Alphabetic bases without diacritics
    0x0110,0x0111,      # D with stroke
    0x0126,0x0127,      # H with stroke
    0x0131,             # dotless i
    0x0237,             # dotless j
    # 0x0132,0x0133,      # IJ ij
    0x0141,0x0142,      # L with stroke
    0x0181,0x0182,      # Africanist Latin consonants
]

# IPA (count: ?)
ipa = [
    # Latin Extended IPA-like (vowels, consonants, modifiers)
    0x0186,0x0187,0x0189,0x018A,0x018B,0x018E,0x018F,0x0190,0x0191,0x0192,
    0x0193,0x0194,0x0196,0x0197,0x0198,0x019C,0x019D,0x019F,0x01B7,
    # Ligatures
    # 0x01AA,0x01BB,0x0184,0x018D,0x0195,0x029A,
    # Clicks
    # 0x01C0,0x01C1,0x01C2,0x01C3,0x0298,
    # Core IPA vowels
    0x0250,0x0251,0x0252,0x0253,0x0254,0x0255,0x0256,0x0257,0x0258,0x0259,
    0x025A,0x025B,0x025C,0x025D,0x025E,0x025F,
    # Core IPA consonants
    0x0260,0x0261,0x0262,0x0263,0x0264,0x0265,0x0266,0x0267,0x0268,0x0269,
    0x026A,0x026B,0x026C,0x026D,0x026E,0x026F,0x0270,0x0271,0x0272,0x0273,
    0x0274,0x0275,
    # 0x0276,
    0x0277,0x0278,0x0279,0x027A,0x027B,0x027C,0x027D,
    0x027E,0x027F,0x0280,0x0281,0x0282,0x0283,0x0284,0x0285,0x0286,0x0287,
    0x0288,0x0289,0x028A,0x028B,0x028C,0x028D,0x028E,0x028F,
    # IPA affricates, fricatives, ejectives, etc.
    0x0290,0x0291,0x0292,0x0293,0x0294,0x0295,0x0296,0x0297,0x0299,
    0x029B,0x029C,0x029D,
    # 0x029E, 
    0x029F,
    # Extended IPA / small caps / modifier-like bases
    # 0x1D00,0x1D01,0x1D02,0x1D03,0x1D04,0x1D05,0x1D06,0x1D07,0x1D08,0x1D09,
    # 0x1D0A,0x1D0B,0x1D0C,0x1D0D,0x1D0E,0x1D0F,0x1D10,0x1D11,0x1D12,0x1D13,
    # 0x1D14,0x1D15,
    # 0x1D16,0x1D17,0x1D18,0x1D19,0x1D1A,0x1D1B,0x1D1C,0x1D1D,0x1D1E,0x1D1F,
    # 0x1D20,0x1D21,0x1D22,0x1D23,0x1D24
]

# Modifiers and superscripts (count: 61)
# 0x02B0,0x02B1,0x02B2,0x02B3,0x02B4,0x02B5,0x02B6,0x02B7,0x02B8,
# 0x02E0,0x02E1,0x02E2,0x02E3,0x02E4,
# 0x02C0,0x02C1,0x02C2,0x02C3,0x02C4,0x02C5,
# 0x02D0,0x02D1,0x02D2,0x02D3,0x02D4,0x02D5,0x02D6,0x02D7,0x02DE,0x02DF,
# 0x1D2C,0x1D2D,0x1D2E,0x1D2F,0x1D30,0x1D31,0x1D32,0x1D33,0x1D34,0x1D35,
# 0x1D36,0x1D37,0x1D38,0x1D39,0x1D3A,0x1D3B,0x1D3C,0x1D3D,0x1D3E,0x1D3F,
# 0x1D40,0x1D41,0x1D42,
# 0x1D43,0x1D44,0x1D45,0x1D46,0x1D47,0x1D48,0x1D49,0x1D4A,0x1D4B,0x1D4C,
# 0x1D4D,0x1D4E,0x1D4F,0x1D50,0x1D51,0x1D52,0x1D53,0x1D54,0x1D55,0x1D56,
# 0x1D57,0x1D58,0x1D59,0x1D5A,0x1D5B,0x1D5C,0x1D5D,0x1D5E,0x1D5F,
# 0x1D60,0x1D61

# Superscript consonants (count: 25)
# Its combining marks: 
# dot above right (U+0358) and comma above right (U+0315) at anchor 1 (above-right);
# acute (U+0301) grave (U+0300) and circumflex (U+0302) at anchor 0 (above); 
# and right angle (U+031A) at anchor 3 (above-right)
superscript_consonant = [
    0x02B0,  # h                     , base_yMax
    0x02B1,  # h with hook           , base_yMax
    0x02B2,  # j (with dot)          , base_yMax
    0x02B3,  # r                     , superscript_meanline
    0x02B4,  # turned r              , superscript_meanline
    0x02B5,  # turned r w/ hook      , superscript_meanline
    0x02B6,  # inverted R            , superscript_meanline
    0x02B7,  # w                     , superscript_meanline
    0x02B8,  # y                     , superscript_meanline
    0x02E0,  # gamma ascender        , base_yMax
    0x02E1,  # l                     , base_yMax
    0x02E2,  # s                     , superscript_meanline
    0x02E3,  # x                     , superscript_meanline
    0x02E4,  # reversed glottal      , base_yMax
    0x1D47,  # b                     , base_yMax
    0x1D4F,  # k                     , base_yMax
    0x1D50,  # m                     , superscript_meanline
    0x1D56,  # p                     , superscript_meanline
    0x1D57,  # t                     , base_yMax
    0x1D5A,  # turned m              , superscript_meanline
    0x1D5B,  # v                     , superscript_meanline
    0x1D5C,  # hangar                , superscript_meanline
    0x1D5D,  # beta                  , base_yMax
    0x1D5E,  # gamma descender       , base_yMax
    0x1D5F,  # delta                 , base_yMax
]

# Greek (count: 48)
greek = [
    0x0391,0x0392,0x0393,0x0394,0x0395,0x0396,0x0397,0x0398,0x0399,0x039A,
    0x039B,0x039C,0x039D,0x039E,0x039F,0x03A0,0x03A1,0x03A3,0x03A4,0x03A5,
    0x03A6,0x03A7,0x03A8,0x03A9,
    0x03B1,0x03B2,0x03B3,0x03B4,0x03B5,0x03B6,0x03B7,0x03B8,0x03B9,0x03BA,
    0x03BB,0x03BC,0x03BD,0x03BE,0x03BF,0x03C0,0x03C1,0x03C3,0x03C4,0x03C5,
    0x03C6,0x03C7,0x03C8,0x03C9,
]

# Cyrillic (count: 66)
cyrillic = [
    0x0410,0x0411,0x0412,0x0413,0x0414,0x0415,0x0416,0x0417,0x0418,0x0419,
    0x041A,0x041B,0x041C,0x041D,0x041E,0x041F,0x0420,0x0421,0x0422,0x0423,
    0x0424,0x0425,0x0426,0x0427,0x0428,0x0429,0x042A,0x042B,0x042C,0x042D,
    0x042E,0x042F,
    0x0430,0x0431,0x0432,0x0433,0x0434,0x0435,0x0436,0x0437,0x0438,0x0439,
    0x043A,0x043B,0x043C,0x043D,0x043E,0x043F,0x0440,0x0441,0x0442,0x0443,
    0x0444,0x0445,0x0446,0x0447,0x0448,0x0449,0x044A,0x044B,0x044C,0x044D,
    0x044E,0x044F,
    0x0401,0x0451,  # Io
    0x0404,0x0454,  # Ukrainian Ye
    0x0407,0x0457,  # Yi
    0x040E,0x045E,  # Short U
    0x04D8,0x04D9,  # Schwa
    0x04E8,0x04E9,  # Barred O
    0x04BA,0x04BB,  # Bashkir Ha
    0x04C0,         # Palochka
    # 0x04CF          # Small palochka
]

precomposed_capital_vowels = [
    0x00C0,0x00C1,0x00C2,0x00C3,0x00C4,0x00C5,0x0100,0x0102,0x0104,0x01CD,
    0x01DE,0x01E0,0x01FA,0x0200,0x0202,0x0226,0x1E00,0x1EA0,0x1EA2,0x1EA4,
    0x1EA6,0x1EA8,0x1EAA,0x1EAC,0x1EAE,0x1EB0,0x1EB2,0x1EB4,0x1EB6,0x00C8,
    0x00C9,0x00CA,0x00CB,0x0112,0x0114,0x0116,0x0118,0x011A,0x0204,0x0206,
    0x0228,0x1E14,0x1E16,0x1E18,0x1E1A,0x1EB8,0x1EBA,0x1EBC,0x1EBE,0x1EC0,
    0x1EC2,0x1EC4,0x1EC6,0x00CC,0x00CD,0x00CE,0x00CF,0x0128,0x012A,0x012C,
    0x012E,0x0130,0x01CF,0x0208,0x020A,0x1E2C,0x1E2E,0x1EC8,0x1ECA,0x00D2,
    0x00D3,0x00D4,0x00D5,0x00D6,0x014C,0x014E,0x0150,0x01D1,0x01EA,0x01EC,
    0x020C,0x020E,0x022A,0x022C,0x022E,0x1E4C,0x1E4E,0x1ECC,0x1ECE,0x1ED0,
    0x1ED2,0x1ED4,0x1ED6,0x1ED8,0x1EDA,0x1EDC,0x1EDE,0x1EE0,0x1EE2,0x00D9,
    0x00DA,0x00DB,0x00DC,0x0168,0x016A,0x016C,0x016E,0x0170,0x01D3,0x01D5,
    0x01D7,0x01D9,0x01DB,0x0214,0x0216,0x1E72,0x1E74,0x1E76,0x1E78,0x1E7A,
    0x1EE4,0x1EE6,0x1EE8,0x1EEA,0x1EEC,0x1EEE,0x1EF0
]

precomposed_small_vowels = [
    0x00E0,0x00E1,0x00E2,0x00E3,0x00E4,0x00E5,0x0101,0x0103,0x0105,0x01CE,
    0x01DF,0x01E1,0x01FB,0x0201,0x0203,0x0227,0x1E01,0x1EA1,0x1EA3,0x1EA5,
    0x1EA7,0x1EA9,0x1EAB,0x1EAD,0x1EAF,0x1EB1,0x1EB3,0x1EB5,0x1EB7,0x00E8,
    0x00E9,0x00EA,0x00EB,0x0113,0x0115,0x0117,0x0119,0x011B,0x0205,0x0207,
    0x0229,0x1E15,0x1E17,0x1E19,0x1E1B,0x1EB9,0x1EBB,0x1EBD,0x1EBF,0x1EC1,
    0x1EC3,0x1EC5,0x1EC7,0x00EC,0x00ED,0x00EE,0x00EF,0x0129,0x012B,0x012D,
    0x012F,0x01D0,0x0209,0x020B,0x1E2D,0x1E2F,0x1EC9,0x1ECB,0x00F2,0x00F3,
    0x00F4,0x00F5,0x00F6,0x014D,0x014F,0x0151,0x01D2,0x01EB,0x01ED,0x020D,
    0x020F,0x022B,0x022D,0x022F,0x1E4D,0x1E4F,0x1ECD,0x1ECF,0x1ED1,0x1ED3,
    0x1ED5,0x1ED7,0x1ED9,0x1EDB,0x1EDD,0x1EDF,0x1EE1,0x1EE3,0x00F9,0x00FA,
    0x00FB,0x00FC,0x0169,0x016B,0x016D,0x016F,0x0171,0x01D4,0x01D6,0x01D8,
    0x01DA,0x01DC,0x0215,0x0217,0x1E73,0x1E75,0x1E77,0x1E79,0x1E7B,0x1EE5,
    0x1EE7,0x1EE9,0x1EEB,0x1EED,0x1EEF,0x1EF1
]

precomposed_capital_consonants = [
    0x1E02,0x1E04,0x00C7,0x0106,0x0108,0x010A,0x010C,0x1E08,0x010E,0x0110,
    0x1E0A,0x1E0C,0x1E0E,0x1E10,0x1E12,0x1E1E,0x011C,0x011E,0x0120,0x0122,
    0x1E20,0x01E4,0x01E6,0x0124,0x1E22,0x1E24,0x1E26,0x1E28,0x1E2A,0x0134,
    0x0136,0x1E30,0x1E32,0x1E34,0x01E8,0x0139,0x013B,0x013D,0x013F,0x0141,
    0x1E36,0x1E38,0x1E3A,0x1E3C,0x1E3E,0x1E40,0x1E42,0x0143,0x0145,0x0147,
    0x1E44,0x1E46,0x1E48,0x1E4A,0x01A0,0x1E54,0x1E56,0x01A4,0x0154,0x0156,
    0x0158,0x1E58,0x1E5A,0x1E5C,0x1E5E,0x015A,0x015C,0x015E,0x0160,0x1E60,
    0x1E62,0x1E64,0x1E66,0x1E68,0x01A7,0x0162,0x0164,0x1E6A,0x1E6C,0x1E6E,
    0x01AC,0x01AE,0x01AF,0x1E7C,0x1E7E,0x01B2,0x0174,0x1E80,0x1E82,0x1E84,
    0x1E8A,0x1E8C,0x00DD,0x0176,0x0178,0x1E8E,0x1EF2,0x1EF4,0x1EF6,0x1EF8,
    0x01B3,0x0179,0x017B,0x017D,0x1E90,0x1E92,0x1E94,0x01B5
]
precomposed_small_consonants = [
    0x1E03,0x1E05,0x0180,0x0183,0x0185,0x00E7,0x0107,0x0109,0x010B,0x010D,
    0x1E09,0x0188,0x010F,0x0111,0x1E0B,0x1E0D,0x1E0F,0x1E11,0x1E13,0x018C,
    0x1E1F,0x011D,0x011F,0x0121,0x0123,0x1E21,0x01E5,0x01E7,0x01E9,0x0125,
    0x1E23,0x1E25,0x1E27,0x1E29,0x1E2B,0x0135,0x0137,0x1E31,0x1E33,0x1E35,
    0x0199,0x013A,0x013C,0x013E,0x0140,0x0142,0x1E37,0x1E39,0x1E3B,0x1E3D,
    0x019A,0x1E3F,0x1E41,0x1E43,0x0144,0x0146,0x0148,0x0149,0x1E45,0x1E47,
    0x1E49,0x1E4B,0x019E,0x01A1,0x01A3,0x1E55,0x1E57,0x01A5,0x0155,0x0157,
    0x0159,0x1E59,0x1E5B,0x1E5D,0x1E5F,0x015B,0x015D,0x015F,0x0161,0x1E61,
    0x1E63,0x1E65,0x1E67,0x1E69,0x01A8,0x0163,0x0165,0x1E6B,0x1E6D,0x1E6F,
    0x01AB,0x01AD,0x01B0,0x1E7D,0x1E7F,0x0175,0x1E81,0x1E83,0x1E85,0x1E8B,
    0x1E8D,0x00FD,0x00FF,0x0177,0x1E8F,0x1EF3,0x1EF5,0x1EF7,0x1EF9,0x01B4,
    0x017A,0x017C,0x017E,0x1E91,0x1E93,0x1E95,0x01B6,0x01BA,0x01BD,0x01BE,
    0x01BF,0x01EF,
]

small_capital = [
    # a-z
    0x0061,0x0062,0x0063,0x0064,0x0065,0x0066,0x0067,0x0068,0x0069,0x006A,
    0x006B,0x006C,0x006D,0x006E,0x006F,0x0070,0x0071,0x0072,0x0073,0x0074,
    0x0075,0x0076,0x0077,0x0078,0x0079,0x007A,
    0x00E6, # ae ligature
    0x00F0, # eth
    0x0153, # oe ligature
    0x00FE, # thorn
    0x0133, # ij ligature
    0x00DF, # Eszett {\addfontfeature{StylisticSet=1}\textsc{ß}}
    0x014B, # eng
    # y.alt
]

rare = [
    0x01B8,0x01B9,0x01F1,0x01F2,0x01F3,0x01C4,0x01C5,0x01C6,0x01C7,0x01C8,
    0x01C9,0x01CA,0x01CB,0x01CC,
]


# Marks

# anchor 0 (count: 21)
mark_above = [
    0x0300,0x0301,0x0302,0x0303,0x0304,0x0306,0x0307,0x0308,0x0309,0x030A,
    0x030B,0x030C,0x030D,0x030F,0x0310,0x0311,0x0312,0x0313,0x033D,0x033E,
    0x033F,
]

# anchor 0
mark_above_rare = [
    # 0x0305,  # overline
    0x030E,  # double vertical line above
    0x0346,  # bridge above
    0x034A,  # not tilde above
    0x034B,  # homothetic above
    0x034C,  # almost equal to above
    0x0350,  # right arrowhead above
    0x0351,  # left half ring above
    0x0352,  # fermata above
    0x0357,  # right half ring above
    0x035B,  # zigzag above
]

# anchor 1
mark_above_right = [
    0x0315, # comma above right
    # 0x031B, # horn (Vietnamese)
    0x0358, # dot above right
]

# anchor 2
mark_below = [
    0x0316,0x0317,0x0318,0x0319,0x031C,0x0320,0x0323,0x0324,0x0325,0x0326,
    0x0329,0x032A,0x032B,0x032C,0x032D,0x032E,0x032F,
]

# anchor 2
mark_below_rare = [
    0x031D,  # left tack below
    0x031E,  # right tack below
    0x031F,  # plus sign below
    0x0330,  # tilde below
    0x0331,  # macron below
    # 0x0332,  # low line
    0x0333,  # double low line
    0x0339,  # right half ring below
    0x033A,  # bridge below
    0x033B,  # square below
    0x033C,  # seagull below
    0x0347,  # equals sign below
    0x0348,  # double vertical line below
    0x0349,  # left angle below
    0x034D,  # left right arrow below
    0x034E,  # upwards arrow below
]

# greek
mark_greek = [
    0x0314,  # reversed comma above
    0x0342,  # Greek perispomeni (above)
    0x0344,  # dialytika + tonos (above)
    0x0345,  # ypogegrammeni (canonical below)
]

# anchor 3
mark_left_angle = [
    0x031A,  # left angle above
]

# anchor 4
mark_below_right = [
    0x0321,  # left half ring below
    0x0322,  # right half ring below
    0x0328,  # ogonek
]

# anchor 5
mark_cedilla = [
    0x0327,
]

# anchor 6
mark_overlay = [
    0x0334, # tilde overlay
    0x0335, # short stroke overlay
    0x0336, # long stroke overlay
    0x0337, # short solidus overlay
    0x0338, # long solidus overlay
]

mark_double = [
    0x035C,  # double breve below
    0x035D,  # double breve above
    0x035E,  # double macron above
    0x035F,  # double macron below
    0x0360,  # double tilde above
    0x0361,  # double inverted breve above
    0x0362,  # double rightwards arrow below
]

# deprecated or not preferred
mark_legacy = [
    0x0340,  # deprecated grave tone mark
    0x0341,  # deprecated acute tone mark
    0x0343,  # deprecated Greek koronis
    # modifiers preferred
    0x0363,0x0364,0x0365,0x0366,0x0367,0x0368,0x0369,0x036A,0x036B,0x036C,
    0x036D,0x036E,0x036F,
]

mark_line = [
    0x0305,  # overline
    0x0332,  # low line
]

mark_above_superscript_consonant = [
    0x0301, # acute
    0x0300, # grave
    0x0302, # circumflex
]


# See also data/LibertinusSerif-Regular-bbox.txt
base_bbox = {
    0x02B0: (10, 364, 301, 739),
    0x02B1: (10, 358, 293, 738),
    0x02B2: (0, 263, 147, 739),
    0x02B3: (18, 365, 238, 637),
    0x02B4: (13, 358, 228, 630),
    0x02B5: (13, 250, 273, 630),
    0x02B6: (22, 364, 262, 638),
    0x02B7: (7, 358, 451, 632),
    0x02B8: (20, 238, 322, 632),
    0x02E0: (15, 358, 295, 683),
    0x02E1: (11, 363, 147, 739),
    0x02E2: (28, 358, 224, 637),
    0x02E3: (18, 364, 298, 633),
    0x02E4: (26, 364, 236, 739),
    0x1D47: (6, 358, 273, 739),
    0x1D4F: (0, 364, 307, 739),
    0x1D50: (10, 365, 487, 637),
    0x1D56: (0, 238, 288, 637),
    0x1D57: (15, 358, 195, 726),
    0x1D58: (14, 358, 308, 632),
    0x1D59: (44, 335, 316, 667),
    0x1D5A: (2, 364, 479, 636),
    0x1D5B: (6, 358, 308, 632),
    0x1D5C: (46, 357, 462, 628),
    0x1D5D: (48, 244, 289, 739),
    0x1D5E: (24, 220, 326, 637),
    0x1D5F: (45, 358, 307, 739),
}

superscript_meanline = 630

# possible values: superscript_meanline, base_yMax, baseline, 
# meanline, xheight, ascender, capheight
vertical_ref = {
    0x02B0: "base_yMax",
    0x02B1: "base_yMax",
    0x02B2: "base_yMax",
    0x02B3: "superscript_meanline",
    0x02B4: "superscript_meanline",
    0x02B5: "superscript_meanline",
    0x02B6: "superscript_meanline",
    0x02B7: "superscript_meanline",
    0x02B8: "superscript_meanline",
    0x02E0: "base_yMax",
    0x02E1: "base_yMax",
    0x02E2: "superscript_meanline",
    0x02E3: "superscript_meanline",
    0x02E4: "base_yMax",
    0x1D47: "base_yMax",
    0x1D4F: "base_yMax",
    0x1D50: "superscript_meanline",
    0x1D56: "superscript_meanline",
    0x1D57: "base_yMax",
    0x1D5A: "superscript_meanline",
    0x1D5B: "superscript_meanline",
    0x1D5C: "superscript_meanline",
    0x1D5D: "base_yMax",
    0x1D5E: "base_yMax",
    0x1D5F: "base_yMax",
}

anchors = {
    1: {
        0x02B0: (347, 648), 0x02B1: (339, 648), 0x02B2: (193, 648),
        0x02B3: (284, 648), 0x02B4: (274, 648), 0x02B5: (319, 648),
        0x02B6: (308, 648), 0x02B7: (497, 648), 0x02B8: (368, 648),
        0x02E0: (341, 648), 0x02E1: (193, 648), 0x02E2: (270, 648),
        0x02E3: (344, 648), 0x02E4: (282, 648), 0x1D47: (319, 648),
        0x1D4F: (353, 648), 0x1D50: (533, 648), 0x1D56: (334, 648),
        0x1D57: (241, 648), 0x1D5A: (525, 648), 0x1D5B: (354, 648),
        0x1D5C: (508, 648), 0x1D5D: (335, 648), 0x1D5E: (372, 648),
        0x1D5F: (353, 648),
    },

# test 2 values computed with compute_baseanchor3(), clearance 0/80. Rejected.
# test 3 values computed with compute_baseanchor3(), clearance -20/70. Accepted.
    3: {       
        0x02B0: (305, 834), 0x02B1: (297, 833), 0x02B2: (151, 834),
        0x02B3: (242, 725), 0x02B4: (232, 725), 0x02B5: (277, 725),
        0x02B6: (266, 725), 0x02B7: (455, 725), 0x02B8: (326, 725),
        0x02E0: (299, 778), 0x02E1: (151, 834), 0x02E2: (228, 725),
        0x02E3: (302, 725), 0x02E4: (240, 834), 0x1D47: (277, 834),
        0x1D4F: (311, 834), 0x1D50: (491, 725), 0x1D56: (292, 725),
        0x1D57: (199, 821), 0x1D5A: (483, 725), 0x1D5B: (312, 725),
        0x1D5C: (466, 725), 0x1D5D: (293, 834), 0x1D5E: (330, 732),
        0x1D5F: (311, 834),
    },

    # anchor 0 from compute_baseanchor0()
        0: {
        0x02B0: (155, 914), 0x02B1: (151, 913), 0x02B2: (73, 914),
        0x02B3: (128, 805), 0x02B4: (120, 805), 0x02B5: (143, 805),
        0x02B6: (142, 805), 0x02B7: (229, 805), 0x02B8: (171, 805),
        0x02E0: (155, 858), 0x02E1: (79, 914), 0x02E2: (126, 805),
        0x02E3: (158, 805), 0x02E4: (131, 914), 0x1D47: (139, 914),
        0x1D4F: (153, 914), 0x1D50: (248, 805), 0x1D56: (144, 805),
        0x1D57: (105, 901), 0x1D5A: (240, 805), 0x1D5B: (157, 805),
        0x1D5C: (254, 805), 0x1D5D: (168, 914), 0x1D5E: (175, 812),
        0x1D5F: (176, 914),
    },
 
}

# Copilot/GPT-5.1
ipa_diacritic_bases = {
    # ABOVE MARKS

    # U+030A COMBINING RING ABOVE (voicelessness)
    0x030A: [
        0x006D, 0x006E, 0x0272, 0x014B,  # m, n, ɲ, ŋ
        0x006C, 0x026B, 0x026C, 0x026E,  # l, ɫ, ɬ, ɮ
        0x0072, 0x0279, 0x027A, 0x027B,  # r, ɹ, ɺ, ɻ
        0x0280, 0x0281,                 # ʀ, ʁ
        0x028B, 0x0265, 0x028E,         # ʋ, ɥ, ʎ
        0x029D, 0x029F,                 # ʝ, ʟ
    ],

    # U+0301 COMBINING ACUTE ACCENT (palatalization / secondary articulation)
    0x0301: [
        0x0074, 0x0064, 0x006E, 0x0073, 0x007A,  # t, d, n, s, z
        0x0255, 0x0291,                          # ɕ, ʑ
        0x006C, 0x0072,                          # l, r
        0x025F, 0x0261, 0x0263,                  # ɟ, ɡ, ɣ
    ],

    # U+0307 COMBINING DOT ABOVE (retroflexion / special articulations)
    0x0307: [
        0x006E, 0x006C, 0x0073, 0x007A,          # n, l, s, z
        0x0273, 0x026D, 0x0282, 0x0290,          # ɳ, ɭ, ʂ, ʐ
    ],

    # U+0303 COMBINING TILDE (creaky voice)
    0x0303: [
        # vowels
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
        # sonorants
        0x006C, 0x0072, 0x0279, 0x027A, 0x027B, 0x027C,
        0x026B, 0x026D, 0x026E, 0x0271, 0x0272, 0x0273, 0x0274,
    ],

    # BELOW MARKS

    # U+032A COMBINING BRIDGE BELOW (dental)
    0x032A: [
        0x0074, 0x0064, 0x006E, 0x0073, 0x007A,  # t, d, n, s, z
        0x027A, 0x0279, 0x027B,                 # ɺ, ɹ, ɻ
    ],

    # U+0329 COMBINING SYLLABIC MARK
    0x0329: [
        0x006C, 0x0072, 0x006D, 0x006E,          # l, r, m, n
        0x026B, 0x026D, 0x026E,                  # ɫ, ɭ, ɮ
        0x0271, 0x0272, 0x0273, 0x0274,          # ɱ, ɲ, ɳ, ɴ
    ],

    # U+0330 COMBINING TILDE BELOW (creaky voice)
    0x0330: [
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
    ],

    # U+0333 COMBINING DOUBLE MACRON BELOW (ATR/RTR)
    0x0333: [
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
    ],

    # U+0323 COMBINING DOT BELOW (retroflex / emphatic / transliteration)
    0x0323: [
        # retroflex series
        0x0256, 0x0273, 0x026D, 0x0288, 0x0282, 0x0290,
        # consonants in transliteration
        0x0253, 0x0257, 0x0260, 0x0261, 0x0262, 0x0263,
        0x0266, 0x0265, 0x028B, 0x0281, 0x0280, 0x0288,
        0x0289, 0x028A, 0x028C,
        # vowels
        0x0259, 0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0264, 0x026F, 0x028A, 0x028C, 0x028F, 0x0275, 0x0276,
    ],
}

# Claude Sonnet 4.5
ipa_diacritic_bases = {
    # ABOVE MARKS

    # U+0300 COMBINING GRAVE ACCENT (tone marking)
    0x0300: [
        # Latin vowels (for reference, mostly precomposed)
        0x0061, 0x0065, 0x0069, 0x006F, 0x0075,  # a, e, i, o, u
        0x00E6,                                  # æ
        # IPA vowels
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
        # Syllabic consonants
        0x006D, 0x006E, 0x006C, 0x0272, 0x014B,  # m, n, l, ɲ, ŋ
    ],

    # U+0301 COMBINING ACUTE ACCENT (tone / palatalization)
    0x0301: [
        # Consonants (palatalization)
        0x0074, 0x0064, 0x006E, 0x0073, 0x007A,  # t, d, n, s, z
        0x0255, 0x0291,                          # ɕ, ʑ
        0x006C, 0x0072,                          # l, r
        0x025F, 0x0261, 0x0263,                  # ɟ, ɡ, ɣ
        # Latin vowels (for reference, mostly precomposed)
        0x0061, 0x0065, 0x0069, 0x006F, 0x0075,  # a, e, i, o, u
        0x00E6,                                  # æ (precomposed as ǽ)
        # IPA vowels
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
        # Syllabic consonants (tone)
        0x006D, 0x006E, 0x006C, 0x0272, 0x014B,  # m, n, l, ɲ, ŋ
    ],

    # U+0302 COMBINING CIRCUMFLEX (falling tone, contour tone)
    0x0302: [
        # Latin vowels (for reference, mostly precomposed)
        0x0061, 0x0065, 0x0069, 0x006F, 0x0075,  # a, e, i, o, u
        0x00E6,                                  # æ
        # IPA vowels
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
    ],

    # U+0303 COMBINING TILDE (nasalization)
    0x0303: [
        # Latin vowels (a, o, n precomposed; e, i, u not precomposed)
        0x0061, 0x0065, 0x0069, 0x006F, 0x0075,  # a, e, i, o, u
        0x00E6,                                  # æ
        # IPA vowels
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
    ],

    # U+0304 COMBINING MACRON (length, high tone)
    0x0304: [
        # Latin vowels (for reference, mostly precomposed)
        0x0061, 0x0065, 0x0069, 0x006F, 0x0075,  # a, e, i, o, u
        0x00E6,                                  # æ (precomposed as ǣ)
        # IPA vowels
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
        # Consonants (length/gemination)
        0x006D, 0x006E, 0x006C, 0x0072, 0x0272, 0x014B,  # m, n, l, r, ɲ, ŋ
    ],

    # U+030A COMBINING RING ABOVE (voicelessness)
    0x030A: [
        0x006D, 0x006E, 0x0272, 0x014B,  # m, n, ɲ, ŋ
        0x006C, 0x026B, 0x026C, 0x026E,  # l, ɫ, ɬ, ɮ
        0x0072, 0x0279, 0x027A, 0x027B,  # r, ɹ, ɺ, ɻ
        0x0280, 0x0281,                  # ʀ, ʁ
        0x028B, 0x0265, 0x028E,          # ʋ, ɥ, ʎ
        0x029D, 0x029F,                  # ʝ, ʟ
    ],

    # U+030B COMBINING DOUBLE ACUTE ACCENT (extra high tone)
    0x030B: [
        # Latin vowels (o, u precomposed; a, e, i not precomposed)
        0x0061, 0x0065, 0x0069, 0x006F, 0x0075,  # a, e, i, o, u
        0x00E6,                                  # æ
        # IPA vowels
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x028A, 0x028C,
    ],

    # U+030C COMBINING CARON (rising tone, dipping tone)
    0x030C: [
        # Latin vowels (for reference, mostly precomposed)
        0x0061, 0x0065, 0x0069, 0x006F, 0x0075,  # a, e, i, o, u
        0x00E6,                                  # æ
        # IPA vowels
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
    ],

    # BELOW MARKS

    # U+031F COMBINING PLUS SIGN BELOW (advanced tongue root)
    0x031F: [
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275,
    ],

    # U+0320 COMBINING MINUS SIGN BELOW (retracted tongue root)
    0x0320: [
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275,
    ],

    # U+0323 COMBINING DOT BELOW (retroflex / emphatic)
    0x0323: [
        # Latin consonants
        0x0066,                          # f (for Berber/Tamazight)
        # Retroflex series
        0x0256, 0x0273, 0x026D, 0x0288, 0x0282, 0x0290,
        # Consonants in transliteration
        0x0253, 0x0257, 0x0260, 0x0261, 0x0262, 0x0263,
        0x0266, 0x0265, 0x028B, 0x0281, 0x0280,
        0x0289, 0x028A, 0x028C,
        # Latin vowels (for reference, many precomposed in Vietnamese block)
        0x0061, 0x0065, 0x0069, 0x006F, 0x0075,  # a, e, i, o, u
        # IPA vowels
        0x0259, 0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0264, 0x026F, 0x028A, 0x028C, 0x028F, 0x0275, 0x0276,
    ],

    # U+0325 COMBINING RING BELOW (voiceless, devoiced)
    0x0325: [
        # Voiced obstruents
        0x0062, 0x0064, 0x0067, 0x0076, 0x007A, 0x0292,  # b, d, g, v, z, ʒ
        # Sonorants
        0x006D, 0x006E, 0x006C, 0x0072, 0x0077, 0x006A,  # m, n, l, r, w, j
        0x0271, 0x0272, 0x0273, 0x014B,                  # ɱ, ɲ, ɳ, ŋ
    ],

    # U+0329 COMBINING SYLLABIC MARK (vertical line below)
    0x0329: [
        0x006C, 0x0072, 0x006D, 0x006E,  # l, r, m, n
        0x026B, 0x026D, 0x026E,          # ɫ, ɭ, ɮ
        0x0271, 0x0272, 0x0273, 0x0274,  # ɱ, ɲ, ɳ, ɴ
    ],

    # U+032A COMBINING BRIDGE BELOW (dental)
    0x032A: [
        0x0074, 0x0064, 0x006E, 0x0073, 0x007A,  # t, d, n, s, z
    ],

    # U+032C COMBINING CARON BELOW (voiced)
    0x032C: [
        0x0070, 0x0074, 0x006B, 0x0066, 0x0073, 0x0283,  # p, t, k, f, s, ʃ
        0x0255, 0x0063, 0x0071,                          # ɕ, c, q
    ],

    # U+0330 COMBINING TILDE BELOW (creaky voice)
    0x0330: [
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
    ],

    # U+0333 COMBINING DOUBLE MACRON BELOW (ATR/RTR)
    0x0333: [
        0x0250, 0x0251, 0x0252, 0x025B, 0x025C, 0x025E,
        0x0259, 0x0258, 0x0264, 0x026F, 0x028A, 0x028C,
        0x028F, 0x0275, 0x0276,
    ],

    # U+033A COMBINING INVERTED BRIDGE BELOW (apical)
    0x033A: [
        0x0074, 0x0064, 0x0073, 0x007A, 0x006E,  # t, d, s, z, n
    ],

    # U+033B COMBINING SQUARE BELOW (laminal)
    0x033B: [
        0x0074, 0x0064, 0x0073, 0x007A, 0x006E,  # t, d, s, z, n
    ],
}

# Third pass (Copilot GPT 5.1)

LATIN_VOWELS = [
    0x0061,0x0065,0x0069,0x006F,0x0075,0x0079,  # a e i o u y
    0x00E6,0x0153,                             # æ œ
]
IPA_VOWELS = [
    0x0250,0x0251,0x0252,0x025B,0x025C,0x025E,
    0x0259,0x0258,0x0264,0x026F,0x028A,0x028C,
    0x028F,0x0275,0x0276,
]
SYLLABIC_SONORANTS = [
    0x006D,0x006E,0x006C,0x0072,
]
PALATALIZABLE = [
    0x0074,0x0064,0x006E,0x0073,0x007A,
    0x0255,0x0291,0x006C,0x0072,
    0x025F,0x0261,0x0263,
]
RETROFLEX_EMPHATIC = [
    0x0256,0x0273,0x026D,0x0288,0x0282,0x0290,
    0x0253,0x0257,0x0260,0x0261,0x0262,0x0263,
    0x0266,0x0265,0x028B,0x0281,0x0280,
]
CORONALS = [
    0x0074,0x0064,0x0073,0x007A,0x006E,
]
VOICELESS_SONORANTS = [
    0x006D,0x006E,0x0272,0x014B,
    0x006C,0x026B,0x026C,0x026E,
    0x0072,0x0279,0x027A,0x027B,
    0x0280,0x0281,
    0x028B,0x0265,0x028E,
    0x029D,0x029F,
]

def uniq(*groups):
    """Return a sorted, deduplicated list of codepoints."""
    out = set()
    for g in groups:
        out.update(g)
    return sorted(out)

ipa_diacritic_bases = {
    # ABOVE MARKS

    # U+0300 GRAVE (tone, stress)
    0x0300: uniq(LATIN_VOWELS, IPA_VOWELS, SYLLABIC_SONORANTS),

    # U+0301 ACUTE (tone, palatalization)
    0x0301: uniq(LATIN_VOWELS, IPA_VOWELS, PALATALIZABLE, SYLLABIC_SONORANTS),

    # U+0302 CIRCUMFLEX (tone contour)
    0x0302: uniq(LATIN_VOWELS, IPA_VOWELS),

    # U+0303 TILDE ABOVE (nasalization)
    0x0303: uniq(LATIN_VOWELS, IPA_VOWELS),

    # U+0304 MACRON (length, tone)
    0x0304: uniq(LATIN_VOWELS, IPA_VOWELS, SYLLABIC_SONORANTS),

    # U+030A RING ABOVE (voicelessness)
    0x030A: VOICELESS_SONORANTS,

    # BELOW MARKS

    # U+031F PLUS BELOW (ATR)
    0x031F: IPA_VOWELS,

    # U+0320 MINUS BELOW (RTR)
    0x0320: IPA_VOWELS,

    # U+0323 DOT BELOW (retroflex, emphatic, transliteration, vowels)
    0x0323: uniq(RETROFLEX_EMPHATIC, LATIN_VOWELS, IPA_VOWELS),

    # U+0325 RING BELOW (devoicing)
    0x0325: [
        # voiced obstruents + sonorants
        0x0062,0x0064,0x0067,0x0076,0x007A,0x0292,
        0x006D,0x006E,0x006C,0x0072,0x0077,0x006A,
        0x0271,0x0272,0x0273,0x014B,
    ],

    # U+0329 SYLLABIC MARK
    0x0329: uniq(
        SYLLABIC_SONORANTS, 
        [0x026B,0x026D,0x026E,0x0271,0x0272,0x0273,0x0274]
    ),

    # U+032A BRIDGE BELOW (dental)
    0x032A: CORONALS,

    # U+032C CARON BELOW (voiced)
    0x032C: [
        0x0070,0x0074,0x006B,0x0066,0x0073,0x0283,
        0x0255,0x0063,0x0071,
    ],

    # U+0330 TILDE BELOW (creaky voice)
    0x0330: IPA_VOWELS,

    # U+0333 DOUBLE MACRON BELOW (ATR/RTR)
    0x0333: IPA_VOWELS,

    # U+033A INVERTED BRIDGE BELOW (apical)
    0x033A: CORONALS,

    # U+033B SQUARE BELOW (laminal)
    0x033B: CORONALS,
}

mark_anchor_required = [
    0x0300,  # grave
    0x0301,  # acute
    0x0302,  # circumflex
    0x0303,  # tilde above
    0x0304,  # macron
    0x030A,  # ring above

    0x031F,  # plus below (ATR)
    0x0320,  # minus below (RTR)
    0x0323,  # dot below
    0x0325,  # ring below
    0x0329,  # syllabic mark
    0x032A,  # bridge below (dental)
    0x032C,  # caron below (voiced)
    0x0330,  # tilde below (creaky)
    0x0333,  # double macron below
    0x033A,  # inverted bridge below (apical)
    0x033B,  # square below (laminal)
]

BASE_ORDER = (
    LATIN_VOWELS
    + IPA_VOWELS
    + SYLLABIC_SONORANTS
    + PALATALIZABLE
    + CORONALS
    + RETROFLEX_EMPHATIC
    + VOICELESS_SONORANTS
)

base_groups = {
    "latin": {"label": "Latin", "items": latin},
    "ipa": {"label": "IPA", "items": ipa},
    "superscript_consonant": {"label": "Superscript consonant", "items": superscript_consonant},
    "greek": {"label": "Greek", "items": greek},
    "cyrillic": {"label": "Cyrillic", "items": cyrillic},
    "small_capital": {"label": "Small capital", "items": small_capital},
    "precomposed_capital_vowels": {"label": "Precomposed capital vowels", "items": precomposed_capital_vowels},
    "precomposed_small_vowels": {"label": "Precomposed small vowels", "items": precomposed_small_vowels},
    "precomposed_capital_consonants": {"label": "Precomposed capital consonants", "items": precomposed_capital_consonants},
    "precomposed_small_consonants": {"label": "Precomposed small consonants", "items": precomposed_small_consonants},
    "rare": {"label": "No marks", "items": rare},
}

def select_bases(*keys):
    return [base_groups[k]["items"] for k in keys]

base_anchor_required = [
    b for b in BASE_ORDER
    if b in set().union(
        *select_bases(
            "latin",
            "ipa",
            "superscript_consonant",
            "greek",
            "cyrillic",
            "small_capital",
            "precomposed_capital_vowels",
            "precomposed_small_vowels",
            "precomposed_capital_consonants",
            "precomposed_small_consonants",
            "rare",
        )
    )
]

base_groups["base_anchor_required"] = {
    "label": "Bases requiring anchors",
    "items": base_anchor_required,
}

mark_groups = {
    "above": {
        "label": "Above",
        "items": mark_above,
        "classID": 0,
    },
    "above_rare": {
        "label": "Above (rare)",
        "items": mark_above_rare,
        "classID": 0,
    },
    "above_right": {
        "label": "Above right (dot and comma)",
        "items": mark_above_right,
        "classID": 1,
    },
    "below": {
        "label": "Below",
        "items": mark_below,
        "classID": 2,
    },
    "below_rare": {
        "label": "Below (rare)",
        "items": mark_below_rare,
        "classID": 2,
    },
    "left_angle": {
        "label": "Above right (left angle)",
        "items": mark_left_angle,
        "classID": 3,
    },
    "below_right": {
        "label": "Below-right",
        "items": mark_below_right,
        "classID": 4,
    },
    "cedilla": {
        "label": "Cedilla",
        "items": mark_cedilla,
        "classID": 5,
    },
    "overlay": {
        "label": "Overlay",
        "items": mark_overlay,
        "classID": 6,
    },
    "double": {
        "label": "Double",
        "items": mark_double,
        "classID": 0,
    },
    "legacy": {
        "label": "Legacy",
        "items": mark_legacy,
        "classID": 0,
    },
    "line": {
        "label": "Line",
        "items": mark_line,
        "classID": 0,
    },
    "superscript_consonant_above": {
        "label": "Superscript consonant (above acute, grave, circumflex)",
        "items": mark_above_superscript_consonant,
        "classID": 0,
    },
    "greek": {
        "label": "Greek",
        "items": mark_greek,
        "classID": None,
    },
    "mark_anchor_required": {
        "label": "Marks requiring anchors",
        "items": mark_anchor_required,
        "classID": None,
    }
}

def select_marks(*keys):
    return [mark_groups[k]["items"] for k in keys]
